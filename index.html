<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal Game</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
        body {
            margin: 0;
            background-color: black;
            color: white;
            font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
        }

        #terminal {
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        #output {
            flex-grow: 1;
            white-space: pre-wrap;
        }

        #input-line {
            display: flex;
            margin-top: 10px;
        }

        #input {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            outline: none;
        }

        #cursor {
            display: inline-block;
            width: 10px;
            height: 18px;
            background-color: white;
            animation: blink 1s step-start infinite;
        }

        @keyframes blink {
            50% { background-color: transparent; }
        }

        .mac-buttons {
            display: flex;
            margin-bottom: 10px;
        }

        .mac-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .red { background-color: #FF605C; }
        .yellow { background-color: #FFBD44; }
        .green { background-color: #00CA4E; }

        .decision-effect {
            color: lime;
            font-weight: bold;
        }

        .game-over {
            color: red;
            font-weight: bold;
        }

        .glow {
            text-shadow: 0 0 5px white;
        }

        .bootup-screen {
            font-size: 14px;
            animation: fadeIn 1s ease-out;
        }

        /* For the iframe */
        #web-view {
            display: none;
            position: absolute;
            width: 100%;
            height: 100%;
            border: none;
            background-color: white;
            z-index: 9999;
        }
    </style>
</head>
<body>
    <div id="terminal">
        <div class="mac-buttons">
            <div class="mac-button red"></div>
            <div class="mac-button yellow"></div>
            <div class="mac-button green"></div>
        </div>
        <div id="output"></div>
        <div id="input-line">
            <span>$ </span><span id="input"></span><span id="cursor"></span>
        </div>
    </div>

    <iframe id="web-view"></iframe>

    <script>
        const terminal = document.getElementById('terminal');
        const output = document.getElementById('output');
        const input = document.getElementById('input');
        const cursor = document.getElementById('cursor');
        const webView = document.getElementById('web-view');

        let gameState = {
            started: false,
            foundLore: false,
            decision1: false,
            decision2: false,
            decision3: false,
            ended: false,
        };

        let booting = true;
        let userInput = '';

        // Input system
        document.addEventListener('keydown', function(event) {
            if (booting) return;

            if (event.key === 'Backspace') {
                userInput = userInput.slice(0, -1);
            } else if (event.key === 'Enter' && !gameState.ended) {
                processInput(userInput.trim());
                userInput = '';
            } else if (event.key.length === 1) {
                userInput += event.key;
            }

            input.textContent = userInput;
            terminal.scrollTop = terminal.scrollHeight;
        });

        // Essential commands
        const essentialCommands = {
            echo: (args) => `echoing: ${args.join(' ')}`,
            date: () => new Date().toLocaleString(),
            website: (args) => {
                if (args.length > 0) {
                    const url = args[0].startsWith('http') ? args[0] : `https://${args[0]}`;
                    openWebsite(url);
                    return `Opening ${url} in a new window...`;
                }
                return 'Usage: website <url>';
            },
        };

        // Process input
        function processInput(command) {
            const [cmd, ...args] = command.split(' ');

            if (!gameState.started) {
                if (cmd === 'start') {
                    gameState.started = true;
                    output.innerHTML += '$ ' + command + '\n';
                    output.innerHTML += 'The terminal hums with hidden power. A mystery lies within...\n';
                    output.innerHTML += 'Can you find all of the secrets?\n';
                } else if (cmd in essentialCommands) {
                    output.innerHTML += `$ ${command}\n${essentialCommands[cmd](args)}\n`;
                } else {
                    output.innerHTML += `$ ${command}\nInvalid command. Type "start" to begin.\n`;
                }
            } else if (gameState.started && !gameState.foundLore) {
                if (cmd === 'lore') {
                    gameState.foundLore = true;
                    output.innerHTML += '$ ' + command + '\n';
                    output.innerHTML += 'A hidden history unravels...\n';
                    output.innerHTML += 'In a world divided, where light battles shadow, whispers of a great fracture circulate. Many seek the truth, yet few possess the courage to face it. Will you become a seeker of knowledge, or will you turn a blind eye?\n';
                    output.innerHTML += 'The sages speak of a key hidden in plain sightâ€”will you dare to find it?\n';
                    applyEffect('decision-effect', 'The choice is yours: "seek" or "deny".');
                } else if (cmd in essentialCommands) {
                    output.innerHTML += `$ ${command}\n${essentialCommands[cmd](args)}\n`;
                } else {
                    output.innerHTML += '$ ' + command + '\nInvalid command. Type "lore" to continue.\n';
                }
            } else if (gameState.foundLore && !gameState.decision1) {
                if (cmd === 'seek') {
                    gameState.decision1 = true;
                    output.innerHTML += '$ ' + command + '\n';
                    output.innerHTML += 'You take a deep breath and plunge into the shadows of truth...\n';
                    output.innerHTML += 'A voice echoes, "What do you fear the most? The truth or the shadows?"\n';
                    output.innerHTML += 'Do you FACE the shadows or HIDE from them?\n';
                    applyEffect('decision-effect', 'Choose "face" or "hide".');
                } else if (cmd === 'deny') {
                    gameState.decision1 = true;
                    endGame('denied the truth', 'You turned away, and the story ends. The fractures grow deeper, lost to time.');
                } else if (cmd in essentialCommands) {
                    output.innerHTML += `$ ${command}\n${essentialCommands[cmd](args)}\n`;
                } else {
                    output.innerHTML += '$ ' + command + '\nInvalid command. Type "seek" or "deny".\n';
                }
            } else if (gameState.decision1 && !gameState.decision2) {
                if (cmd === 'face') {
                    gameState.decision2 = true;
                    output.innerHTML += '$ ' + command + '\n';
                    output.innerHTML += 'You embrace the shadows, uncovering the ancient secrets they guard...\n';
                    output.innerHTML += 'In the heart of darkness lies the essence of creation. Do you CHALLENGE the essence or EMBRACE it?\n';
                    applyEffect('decision-effect', 'Choose "challenge" or "embrace".');
                } else if (cmd === 'hide') {
                    gameState.decision2 = true;
                    endGame('hid from the shadows', 'The shadows consumed you. The light of truth fades away, leaving nothing but silence.');
                } else if (cmd in essentialCommands) {
                    output.innerHTML += `$ ${command}\n${essentialCommands[cmd](args)}\n`;
                } else {
                    output.innerHTML += '$ ' + command + '\nInvalid command. Type "face" or "hide".\n';
                }
            } else if (gameState.decision2 && !gameState.decision3) {
                if (cmd === 'challenge') {
                    gameState.decision3 = true;
                    endGame('challenged the essence', 'A great clash erupts, reshaping the world. You emerge a beacon of light, restoring balance.');
                } else if (cmd === 'embrace') {
                    gameState.decision3 = true;
                    endGame('embraced the essence', 'The shadows meld with your spirit, granting you unimaginable power, but at a cost.');
                } else if (cmd in essentialCommands) {
                    output.innerHTML += `$ ${command}\n${essentialCommands[cmd](args)}\n`;
                } else {
                    output.innerHTML += '$ ' + command + '\nInvalid command. Type "challenge" or "embrace".\n';
                }
            }
        }

        // Apply effects
        function applyEffect(className, message) {
            output.innerHTML += `<span class="${className}">${message}</span>\n`;
        }

        // End the game
        function endGame(action, message) {
            gameState.ended = true;
            output.innerHTML += `Game Over: You ${action}.\n`;
            output.innerHTML += message + '\n';
            cursor.style.display = 'none'; // Hide the cursor
        }

        // Boot-up sequence
        function bootupScreen() {
            output.innerHTML += 'Starting terminal...\n';
            output.innerHTML += 'Loading system files...\n';
            output.innerHTML += 'Initializing...\n';
            setTimeout(() => {
                booting = false;
                output.innerHTML += 'Terminal ready. Type "start" or essential commands like "echo", "date", or "website".\n';
            }, 3000);
        }

        // Open website in about:blank embed
        function openWebsite(url) {
            webView.src = url;
            webView.style.display = 'block';
        }

        // Run boot-up sequence
        window.onload = function() {
            bootupScreen();
        };
    </script>
</body>
</html>
