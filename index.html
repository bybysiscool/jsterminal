<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal Game</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
        body {
            margin: 0;
            background-color: black;
            color: white;
            font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
            height: 100vh;
            overflow: hidden;
        }

        #terminal {
            padding: 20px;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        #output {
            flex-grow: 1;
            white-space: pre-wrap;
            overflow-y: auto;
            word-wrap: break-word;
            max-height: calc(100% - 40px);
        }

        #input-line {
            display: flex;
            margin-top: 10px;
        }

        #input {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            outline: none;
            display: inline;
        }

        #cursor {
            display: inline-block;
            width: 10px;
            height: 18px;
            background-color: white;
            animation: blink 1s step-start infinite;
        }

        @keyframes blink {
            50% { background-color: transparent; }
        }

        .mac-buttons {
            display: flex;
            margin-bottom: 10px;
        }

        .mac-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .red { background-color: #FF605C; }
        .yellow { background-color: #FFBD44; }
        .green { background-color: #00CA4E; }

        .decision-effect {
            color: lime;
            font-weight: bold;
        }

        .game-over {
            color: red;
            font-weight: bold;
        }

        .glow {
            text-shadow: 0 0 5px white;
        }

        /* For the iframe */
        #web-view {
            display: none;
            position: absolute;
            width: 100%;
            height: 100%;
            border: none;
            background-color: white;
            z-index: 9999;
        }

        /* Additional styles for effects */
        .destroy-effect {
            animation: shake 0.5s forwards;
        }

        @keyframes shake {
            0% { transform: translate(0); }
            25% { transform: translate(-5px); }
            50% { transform: translate(5px); }
            75% { transform: translate(-5px); }
            100% { transform: translate(0); }
        }

        /* Explosion effect */
        @keyframes explosion {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(2); opacity: 0.5; }
            100% { transform: scale(5); opacity: 0; }
        }

        .explosion {
            width: 100px;
            height: 100px;
            background-color: red;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: explosion 2s forwards;
        }

        .heart {
            color: red;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div id="terminal">
        <div class="mac-buttons">
            <div class="mac-button red"></div>
            <div class="mac-button yellow"></div>
            <div class="mac-button green"></div>
        </div>
        <div id="output"></div>
        <div id="input-line">
            <span>$ </span><span id="input"></span><span id="cursor"></span>
        </div>
    </div>

    <iframe id="web-view"></iframe>

    <script>
        const terminal = document.getElementById('terminal');
        const output = document.getElementById('output');
        const input = document.getElementById('input');
        const cursor = document.getElementById('cursor');
        const webView = document.getElementById('web-view');

        let gameState = {
            started: false,
            foundLore: false,
            decisions: 0,
            ended: false,
            inBossFight: false,
        };

        let booting = true;
        let userInput = '';

        // Typing sound effect
        const typingSound = new Audio('typing-sound.mp3'); // Add a typing sound file here
        const explosionSound = new Audio('explosion.mp3'); // Add explosion sound for the boss fight transition
        const shootSound = new Audio('shoot.mp3'); // Add shooting sound file
        const damageSound = new Audio('damage.mp3'); // Add damage sound file
        const bossMusic = new Audio('boss-music.mp3'); // Add boss music file here

        // Input system
        document.addEventListener('keydown', function(event) {
            if (booting || gameState.inBossFight) return;

            if (event.key === 'Backspace') {
                userInput = userInput.slice(0, -1);
            } else if (event.key === 'Enter' && !gameState.ended) {
                processInput(userInput.trim());
                userInput = '';
            } else if (event.key.length === 1) {
                userInput += event.key;
            }

            input.textContent = userInput;
            terminal.scrollTop = terminal.scrollHeight; // Auto scroll to bottom
        });

        // Essential commands
        const essentialCommands = {
            echo: (args) => `echoing: ${args.join(' ')}`,
            date: () => new Date().toLocaleString(),
            website: (args) => {
                if (args.length > 0) {
                    const url = args[0].startsWith('http') ? args[0] : `https://${args[0]}`;
                    openWebsite(url);
                    return `Opening ${url} in a new window...`;
                }
                return 'Usage: website <url>';
            },
        };

        // Process input
        function processInput(command) {
            const [cmd, ...args] = command.split(' ');

            if (!gameState.started) {
                if (cmd === 'start') {
                    gameState.started = true;
                    typeWriter('The terminal hums with hidden power. A mystery lies within...\nCan you find all of the secrets?\n');
                } else if (cmd in essentialCommands) {
                    typeWriter(`${essentialCommands[cmd](args)}\n`);
                } else {
                    typeWriter('Invalid command. Type "start" to begin.\n');
                }
            } else if (gameState.started && !gameState.foundLore) {
                if (cmd === 'lore') {
                    gameState.foundLore = true;
                    typeWriter(longLore(), 100); // Faster for lore
                } else if (cmd in essentialCommands) {
                    typeWriter(`${essentialCommands[cmd](args)}\n`);
                } else {
                    typeWriter('Invalid command. Type "lore" to continue.\n');
                }
            } else if (gameState.foundLore && gameState.decisions < 15) {
                handleDecision(cmd);
            }

            // Handle general commands
            if (cmd in essentialCommands) {
                typeWriter(`${essentialCommands[cmd](args)}\n`);
            }
        }

        // Handle decisions
        function handleDecision(cmd) {
            const decisionPrompts = [
                'What will you pick? (seek/embrace)',
                'What will you choose? (challenge/accept)',
                'What will you decide? (delve/step back)',
                'What will you break? (seal/leave)',
                'What do you wish for? (destroy/peace)',
                'Will you fight? (creator/submit)',
                'Will you trust? (instincts/code)',
                'What will you open? (door/stay)',
                'Will you embrace? (chaos/order)',
                'What do you believe? (truth/nottruth)',
                'What will you uncover? (hidden/past)',
                'Will you challenge? (fate/accept)',
                'Do you seek? (creator/destroy)',
                'What do you want? (truth/ignorance)',
                'What will you unlock? (final/secret)',
                'What will you remember? (past/forget)',
            ];

            const currentPrompt = decisionPrompts[gameState.decisions];
            if (currentPrompt) {
                typeWriter(`${currentPrompt}\n`, 100);
                typeWriter(`Your options are: ${currentPrompt.split(' ').slice(-1)[0].split('/').join(', ')}\n`, 100);
            }

            if (cmd === 'seek' || cmd === 'embrace' || cmd === 'challenge' || cmd === 'accept' ||
                cmd === 'delve' || cmd === 'step' || cmd === 'break' || cmd === 'leave' ||
                cmd === 'destroy' || cmd === 'peace' || cmd === 'fight' || cmd === 'submit' ||
                cmd === 'trust' || cmd === 'open' || cmd === 'chaos' || cmd === 'order' ||
                cmd === 'truth' || cmd === 'nottruth' || cmd === 'uncover' || cmd === 'hidden' ||
                cmd === 'challenge' || cmd === 'fate' || cmd === 'want' || cmd === 'unlock' ||
                cmd === 'final' || cmd === 'remember' || cmd === 'forget') {
                typeWriter(`You chose to ${cmd}.\n`, 100);
                gameState.decisions++;
                if (gameState.decisions === 15) {
                    triggerBossFight();
                }
            } else {
                typeWriter('Invalid choice. Try again.\n', 100);
            }
        }

        // Trigger the boss fight
        function triggerBossFight() {
            gameState.inBossFight = true;
            typeWriter('The terminal quakes as the true battle begins...\n', 100);
            typeWriter('Prepare yourself for the boss fight!\n', 100);
            displayHearts(8);
            bossMusic.play();
        }

        // Typewriter effect
        function typeWriter(text, delay = 50) {
            let index = 0;

            // Disable input while typing
            document.removeEventListener('keydown', handleKeyDown);

            function handleKeyDown(event) {
                event.preventDefault();
            }

            const typingInterval = setInterval(() => {
                if (index < text.length) {
                    output.textContent += text.charAt(index);
                    if (text.charAt(index) !== '\n') {
                        typingSound.play(); // Play typing sound for each character
                    }
                    index++;
                } else {
                    clearInterval(typingInterval);
                    // Re-enable input after typing is complete
                    document.addEventListener('keydown', handleKeyDown);
                    terminal.scrollTop = terminal.scrollHeight; // Auto scroll to bottom
                }
            }, delay);
        }

        // Long lore text
        function longLore() {
            return `In the beginning, there was only silence... 
As the codes flowed into existence, a great creator emerged from the void. 
But as the creator formed this terminal, shadows whispered secrets of power and chaos. 
A struggle began, leading to the separation of light and darkness. 
Those who sought the truth faced trials and decisions that shaped their destinies. 
To uncover the secrets hidden within the terminal, they must conquer their fears, embrace the unknown, 
and ultimately face the creator to decide the fate of all.\n`;
        }

        // Display hearts during boss fight
        function displayHearts(count) {
            const hearts = document.createElement('div');
            hearts.classList.add('heart');
            hearts.textContent = '❤️'.repeat(count);
            output.appendChild(hearts);
            terminal.scrollTop = terminal.scrollHeight; // Auto scroll to bottom
        }

        // Open a website
        function openWebsite(url) {
            webView.src = url;
            webView.style.display = 'block';
            webView.focus();
            webView.contentWindow.location.href = url; // For browsers that support it
        }

        // Start the boot process
        setTimeout(() => {
            typeWriter('Booting up...\n', 100);
            booting = false;
        }, 1000);

        // Add game over condition if necessary
        function gameOver() {
            gameState.ended = true;
            typeWriter('Game Over.\n', 100);
        }

        // Initialize the game
        function initGame() {
            typeWriter('Welcome to the Terminal Game!\nType "start" to begin.\n');
        }

        initGame();
    </script>
</body>
</html>
