<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal Game</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
        body {
            margin: 0;
            background-color: black;
            color: white;
            font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
            height: 100vh;
            overflow: hidden;
        }

        #terminal {
            padding: 20px;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        #output {
            flex-grow: 1;
            white-space: pre-wrap;
            overflow-y: auto;
            word-wrap: break-word;
            max-height: calc(100% - 40px);
        }

        #input-line {
            display: flex;
            margin-top: 10px;
        }

        #input {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            outline: none;
            display: inline;
        }

        #cursor {
            display: inline-block;
            width: 10px;
            height: 18px;
            background-color: white;
            animation: blink 1s step-start infinite;
        }

        @keyframes blink {
            50% { background-color: transparent; }
        }

        .mac-buttons {
            display: flex;
            margin-bottom: 10px;
        }

        .mac-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .red { background-color: #FF605C; }
        .yellow { background-color: #FFBD44; }
        .green { background-color: #00CA4E; }

        .decision-effect {
            color: lime;
            font-weight: bold;
        }

        .game-over {
            color: red;
            font-weight: bold;
        }

        .glow {
            text-shadow: 0 0 5px white;
        }

        /* For the iframe */
        #web-view {
            display: none;
            position: absolute;
            width: 100%;
            height: 100%;
            border: none;
            background-color: white;
            z-index: 9999;
        }

        /* Additional styles for effects */
        .destroy-effect {
            animation: shake 0.5s forwards;
        }

        @keyframes shake {
            0% { transform: translate(0); }
            25% { transform: translate(-5px); }
            50% { transform: translate(5px); }
            75% { transform: translate(-5px); }
            100% { transform: translate(0); }
        }

        /* Explosion effect */
        @keyframes explosion {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(2); opacity: 0.5; }
            100% { transform: scale(5); opacity: 0; }
        }

        .explosion {
            width: 100px;
            height: 100px;
            background-color: red;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: explosion 2s forwards;
        }

        /* Bullet hell styles */
        .bullet {
            width: 10px;
            height: 10px;
            background-color: red;
            border-radius: 50%;
            position: absolute;
            animation: moveBullet 1s linear infinite;
        }

        @keyframes moveBullet {
            from {
                transform: translateY(100vh);
            }
            to {
                transform: translateY(-10px);
            }
        }

        .player {
            width: 20px;
            height: 20px;
            background-color: blue;
            border-radius: 50%;
            position: absolute;
            bottom: 10px;
            left: calc(50% - 10px);
        }
    </style>
</head>
<body>
    <div id="terminal">
        <div class="mac-buttons">
            <div class="mac-button red"></div>
            <div class="mac-button yellow"></div>
            <div class="mac-button green"></div>
        </div>
        <div id="output"></div>
        <div id="input-line">
            <span>$ </span><span id="input"></span><span id="cursor"></span>
        </div>
    </div>

    <iframe id="web-view"></iframe>

    <script>
        const terminal = document.getElementById('terminal');
        const output = document.getElementById('output');
        const input = document.getElementById('input');
        const cursor = document.getElementById('cursor');
        const webView = document.getElementById('web-view');

        let gameState = {
            started: false,
            foundLore: false,
            decisions: 0,
            ended: false,
        };

        let booting = true;
        let userInput = '';

        // Typing sound effect
        const typingSound = new Audio('typing-sound.mp3'); // Add a typing sound file here
        const explosionSound = new Audio('explosion.mp3'); // Add explosion sound for the boss fight transition
        const shootSound = new Audio('shoot.mp3'); // Add shooting sound file
        const damageSound = new Audio('damage.mp3'); // Add damage sound file

        // Input system
        document.addEventListener('keydown', function(event) {
            if (booting) return;

            if (event.key === 'Backspace') {
                userInput = userInput.slice(0, -1);
            } else if (event.key === 'Enter' && !gameState.ended) {
                processInput(userInput.trim());
                userInput = '';
            } else if (event.key.length === 1) {
                userInput += event.key;
            }

            input.textContent = userInput;
            terminal.scrollTop = terminal.scrollHeight; // Auto scroll to bottom
        });

        // Essential commands
        const essentialCommands = {
            echo: (args) => `echoing: ${args.join(' ')}`,
            date: () => new Date().toLocaleString(),
            website: (args) => {
                if (args.length > 0) {
                    const url = args[0].startsWith('http') ? args[0] : `https://${args[0]}`;
                    openWebsite(url);
                    return `Opening ${url} in a new window...`;
                }
                return 'Usage: website <url>';
            },
        };

        // Process input
        function processInput(command) {
            const [cmd, ...args] = command.split(' ');

            if (!gameState.started) {
                if (cmd === 'start') {
                    gameState.started = true;
                    typeWriter('The terminal hums with hidden power. A mystery lies within...\nCan you find all of the secrets?\n');
                } else if (cmd in essentialCommands) {
                    typeWriter(`${essentialCommands[cmd](args)}\n`);
                } else {
                    typeWriter('Invalid command. Type "start" to begin.\n');
                }
            } else if (gameState.started && !gameState.foundLore) {
                if (cmd === 'lore') {
                    gameState.foundLore = true;
                    typeWriter(longLore(), 100); // Faster for lore
                } else if (cmd in essentialCommands) {
                    typeWriter(`${essentialCommands[cmd](args)}\n`);
                } else {
                    typeWriter('Invalid command. Type "lore" to continue.\n');
                }
            } else if (gameState.foundLore && gameState.decisions < 15) {
                handleDecision(cmd);
            }

            // Handle general commands
            if (cmd in essentialCommands) {
                typeWriter(`${essentialCommands[cmd](args)}\n`);
            }
        }

        // Handle decisions
        function handleDecision(cmd) {
            const decisionPrompts = [
                'Do you face the shadows or hide from the truth?',
                'Will you challenge the essence or embrace it?',
                'Do you delve deeper into the code or step back?',
                'Will you break the seal of creation or leave it intact?',
                'Do you seek to destroy the terminal or find peace within it?',
                'Will you accept the creator’s will or defy it?',
                'Do you believe in the myths or in reality?',
                'Will you unlock the final secret or remain in ignorance?',
                'Is the truth worth the cost?',
                'Do you seek the creator or the destruction of the terminal?',
                'Will you fight the creator or submit?',
            ];

            const decisions = {
                face: () => nextDecision('You face the shadows and step into the unknown...', 100),
                hide: () => endGame('hid from the truth', 'You turned away, the darkness consumes you.'),
                challenge: () => nextDecision('You challenge the essence, power surges within you...', 100),
                embrace: () => endGame('embraced it', 'You found solace in the code. The terminal fades.'),
                delve: () => nextDecision('You delve deeper, uncovering secrets of the creator...', 100),
                step: () => endGame('stepped back', 'You returned to the mundane, never knowing the truth.'),
                break: () => nextDecision('You break the seal, unleashing chaos...', 100),
                leave: () => endGame('left it intact', 'The balance remains, but the truth eludes you.'),
                destroy: () => beginBossBattle(),
                find: () => endGame('found peace', 'You discovered harmony in the terminal.'),
                accept: () => nextDecision('You accept the creator’s will, embracing your fate...', 100),
                defy: () => endGame('defied it', 'You stood against fate, but the terminal retaliated.'),
                believe: () => nextDecision('You believe in the myths, gaining strength from legends...', 100),
                unlock: () => nextDecision('You unlock the final secret, knowledge flooding your mind...', 100),
                cost: () => endGame('paid the cost', 'The truth came at a great price.'),
                seek: () => beginBossBattle(),
                fight: () => beginBossBattle(),
                submit: () => endGame('submitted', 'You accepted fate, but the terminal devoured your essence.'),
            };

            if (decisionPrompts.includes(cmd)) {
                gameState.decisions++;
                if (decisions[cmd]) {
                    decisions[cmd]();
                } else {
                    typeWriter('Invalid decision. Please choose again.\n');
                }
            } else {
                typeWriter('Invalid decision. Please try again.\n');
            }

            if (gameState.decisions >= 15) {
                typeWriter('You have reached the end of your journey. The terminal fades...\n');
                gameState.ended = true;
            }
        }

        function nextDecision(message, delay) {
            typeWriter(message + '\n', delay);
        }

        function endGame(decision, message) {
            typeWriter(`You ${decision}. ${message}\n`, 100);
            gameState.ended = true;
        }

        // Boss battle start
        function beginBossBattle() {
            typeWriter('You have chosen to face the creator...\nPrepare for the battle of your life!\n', 100);
            transitionToBossFight();
        }

        // Transition to boss fight
        function transitionToBossFight() {
            explosionSound.play();
            const explosionDiv = document.createElement('div');
            explosionDiv.className = 'explosion';
            document.body.appendChild(explosionDiv);

            setTimeout(() => {
                explosionDiv.remove();
                setupBulletHell();
            }, 2000); // Adjust time as needed
        }

        // Setup bullet hell
        function setupBulletHell() {
            const player = document.createElement('div');
            player.className = 'player';
            document.body.appendChild(player);

            setInterval(() => {
                spawnBullet();
            }, 1000); // Spawn bullets every second

            document.addEventListener('mousemove', (event) => {
                const rect = terminal.getBoundingClientRect();
                const mouseX = event.clientX - rect.left;
                player.style.left = `${mouseX - 10}px`; // Center player on mouse
            });
        }

        // Spawn bullets
        function spawnBullet() {
            const bullet = document.createElement('div');
            bullet.className = 'bullet';
            bullet.style.left = `${Math.random() * window.innerWidth}px`; // Random horizontal position
            document.body.appendChild(bullet);

            setTimeout(() => {
                bullet.remove(); // Remove bullet after some time
            }, 2000); // Adjust bullet life span
        }

        // Typewriter effect for text display
        function typeWriter(text, delay = 50) {
            let i = 0;
            function writer() {
                if (i < text.length) {
                    output.innerText += text.charAt(i);
                    i++;
                    typingSound.play();
                    setTimeout(writer, delay);
                } else {
                    terminal.scrollTop = terminal.scrollHeight; // Auto scroll to bottom
                }
            }
            writer();
        }

        // Open website in a new window
        function openWebsite(url) {
            webView.style.display = 'block';
            webView.src = url;
        }

        // Long lore example
        function longLore() {
            return "Long lore text goes here...\nMore lore details...\n";
        }

        // Initial boot sequence
        setTimeout(() => {
            typeWriter('Booting...\n', 100);
            setTimeout(() => {
                booting = false;
                typeWriter('Boot complete.\nType "start" to begin.\n', 100);
            }, 2000);
        }, 1000);
    </script>
</body>
</html>
