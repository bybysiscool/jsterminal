<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal Game</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
        body {
            margin: 0;
            background-color: black;
            color: white;
            font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
            height: 100vh;
            overflow: hidden;
        }

        #terminal {
            padding: 20px;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        #output {
            flex-grow: 1;
            white-space: pre-wrap;
            overflow-y: auto;
            word-wrap: break-word;
        }

        #input-line {
            display: flex;
            margin-top: 10px;
        }

        #input {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            outline: none;
        }

        #cursor {
            display: inline-block;
            width: 10px;
            height: 18px;
            background-color: white;
            animation: blink 1s step-start infinite;
        }

        @keyframes blink {
            50% { background-color: transparent; }
        }

        .mac-buttons {
            display: flex;
            margin-bottom: 10px;
        }

        .mac-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .red { background-color: #FF605C; }
        .yellow { background-color: #FFBD44; }
        .green { background-color: #00CA4E; }

        .decision-effect {
            color: lime;
            font-weight: bold;
        }

        .game-over {
            color: red;
            font-weight: bold;
        }

        .glow {
            text-shadow: 0 0 5px white;
        }

        /* For the iframe */
        #web-view {
            display: none;
            position: absolute;
            width: 100%;
            height: 100%;
            border: none;
            background-color: white;
            z-index: 9999;
        }

        /* Additional styles for effects */
        .destroy-effect {
            animation: shake 0.5s forwards;
        }

        @keyframes shake {
            0% { transform: translate(0); }
            25% { transform: translate(-5px); }
            50% { transform: translate(5px); }
            75% { transform: translate(-5px); }
            100% { transform: translate(0); }
        }
    </style>
</head>
<body>
    <div id="terminal">
        <div class="mac-buttons">
            <div class="mac-button red"></div>
            <div class="mac-button yellow"></div>
            <div class="mac-button green"></div>
        </div>
        <div id="output"></div>
        <div id="input-line">
            <span>$ </span><span id="input"></span><span id="cursor"></span>
        </div>
    </div>

    <iframe id="web-view"></iframe>

    <script>
        const terminal = document.getElementById('terminal');
        const output = document.getElementById('output');
        const input = document.getElementById('input');
        const cursor = document.getElementById('cursor');
        const webView = document.getElementById('web-view');

        let gameState = {
            started: false,
            foundLore: false,
            decision1: false,
            decision2: false,
            decision3: false,
            ended: false,
        };

        let booting = true;
        let userInput = '';

        // Input system
        document.addEventListener('keydown', function(event) {
            if (booting) return;

            if (event.key === 'Backspace') {
                userInput = userInput.slice(0, -1);
            } else if (event.key === 'Enter' && !gameState.ended) {
                processInput(userInput.trim());
                userInput = '';
            } else if (event.key.length === 1) {
                userInput += event.key;
            }

            input.textContent = userInput;
            terminal.scrollTop = terminal.scrollHeight;
        });

        // Essential commands
        const essentialCommands = {
            echo: (args) => `echoing: ${args.join(' ')}`,
            date: () => new Date().toLocaleString(),
            website: (args) => {
                if (args.length > 0) {
                    const url = args[0].startsWith('http') ? args[0] : `https://${args[0]}`;
                    openWebsite(url);
                    return `Opening ${url} in a new window...`;
                }
                return 'Usage: website <url>';
            },
        };

        // Process input
        function processInput(command) {
            const [cmd, ...args] = command.split(' ');

            if (!gameState.started) {
                if (cmd === 'start') {
                    gameState.started = true;
                    typeWriter('The terminal hums with hidden power. A mystery lies within...\nCan you find all of the secrets?\n');
                } else if (cmd in essentialCommands) {
                    typeWriter(`${essentialCommands[cmd](args)}\n`);
                } else {
                    typeWriter('Invalid command. Type "start" to begin.\n');
                }
            } else if (gameState.started && !gameState.foundLore) {
                if (cmd === 'lore') {
                    gameState.foundLore = true;
                    typeWriter(longLore());
                } else if (cmd in essentialCommands) {
                    typeWriter(`${essentialCommands[cmd](args)}\n`);
                } else {
                    typeWriter('Invalid command. Type "lore" to continue.\n');
                }
            } else if (gameState.foundLore && !gameState.decision1) {
                if (cmd === 'seek') {
                    gameState.decision1 = true;
                    typeWriter('You take a deep breath and plunge into the shadows of truth...\nA voice echoes, "What do you fear the most? The truth or the shadows?"\nDo you FACE the shadows or HIDE from them?\n');
                    applyEffect('decision-effect', 'Choose "face" or "hide".');
                } else if (cmd === 'deny') {
                    gameState.decision1 = true;
                    endGame('denied the truth', 'You turned away, and the story ends. The fractures grow deeper, lost to time.');
                } else if (cmd in essentialCommands) {
                    typeWriter(`${essentialCommands[cmd](args)}\n`);
                } else {
                    typeWriter('Invalid command. Type "seek" or "deny".\n');
                }
            } else if (gameState.decision1 && !gameState.decision2) {
                if (cmd === 'face') {
                    gameState.decision2 = true;
                    typeWriter('You embrace the shadows, uncovering the ancient secrets they guard...\nIn the heart of darkness lies the essence of creation. Do you CHALLENGE the essence or EMBRACE it?\n');
                    applyEffect('decision-effect', 'Choose "challenge" or "embrace".');
                } else if (cmd === 'hide') {
                    gameState.decision2 = true;
                    endGame('hid from the shadows', 'The shadows consumed you. The light of truth fades away, leaving nothing but silence.');
                } else if (cmd in essentialCommands) {
                    typeWriter(`${essentialCommands[cmd](args)}\n`);
                } else {
                    typeWriter('Invalid command. Type "face" or "hide".\n');
                }
            } else if (gameState.decision2 && !gameState.decision3) {
                if (cmd === 'challenge') {
                    gameState.decision3 = true;
                    endGame('challenged the essence', 'A great clash erupts, reshaping the world. You emerge a beacon of light, restoring balance.');
                } else if (cmd === 'embrace') {
                    gameState.decision3 = true;
                    endGame('embraced the essence', 'The shadows meld with your spirit, granting you unimaginable power, but at a cost.');
                } else if (cmd in essentialCommands) {
                    typeWriter(`${essentialCommands[cmd](args)}\n`);
                } else {
                    typeWriter('Invalid command. Type "challenge" or "embrace".\n');
                }
            }
        }

        // Typewriter effect for displaying text
        function typeWriter(text, delay = 50) {
            const lines = text.split('\n');
            lines.forEach((line, index) => {
                setTimeout(() => {
                    output.innerHTML += line + '\n';
                    terminal.scrollTop = terminal.scrollHeight; // Auto scroll to bottom
                }, delay * index);
            });
        }

        // Long lore explanation
        function longLore() {
            return `
            As you sit before the terminal, its glow beckons you closer. You sense a presence, 
            something ancient and unfathom

able, waiting within the lines of code. The terminal hums 
            softly, as if breathing, and you realize that it’s not just a machine; it’s a portal 
            to knowledge long forgotten. Whispers of the creator echo through the circuitry, urging 
            you to seek the truth hidden beneath layers of algorithms and forgotten data.

            The stories speak of a time when light and shadow were one, a harmonious dance of 
            creation. Yet, as knowledge grew, so did the shadows. They twisted the essence of 
            information, creating chaos within the realm of the terminal. The creator, in a moment 
            of desperation, sealed away the darkness, embedding fragments of their essence into the 
            very code that you now engage with. Your journey begins here, but the path is shrouded in 
            secrets and choices.

            Will you dare to venture deeper, unraveling the secrets that lie dormant, or will you 
            turn back, forever haunted by the knowledge of what could have been? Can you resist the 
            lure of power that comes from uncovering these truths? The terminal is not merely a 
            window to the world; it is a living entity, imbued with the spirit of its creator.

            As you contemplate your next move, a single thought resounds: **Can you find all of the secrets?** 
            The shadows call, and with each decision, you draw closer to either your salvation or your 
            destruction. Every command you enter echoes through the fabric of this digital existence, 
            shaping the outcome of your journey.

            The terminal is your ally, but it can also be your undoing. You sense the weight of 
            your choices; each decision creates ripples in the digital ether, potentially unraveling 
            the very code that binds this reality. Do you have the courage to confront the shadows 
            and embrace the truths that await?

            **Seek your creator. Destroy the terminal. Or let it guide you to a destiny beyond your 
            imagination. The fate of your journey is now in your hands.**
            `;
        }

        // Apply effects
        function applyEffect(className, message) {
            output.innerHTML += `<span class="${className}">${message}</span>\n`;
        }

        // End the game
        function endGame(action, message) {
            gameState.ended = true;
            output.innerHTML += `Game Over: You ${action}.\n`;
            output.innerHTML += message + '\n';
            cursor.style.display = 'none'; // Hide the cursor
            applyEffect('destroy-effect', 'The terminal shakes violently as it crumbles around you. The world fades to black.');
        }

        // Boot-up sequence
        function bootupScreen() {
            output.innerHTML += 'Starting terminal...\n';
            output.innerHTML += 'Loading system files...\n';
            output.innerHTML += 'Initializing...\n';
            setTimeout(() => {
                booting = false;
                output.innerHTML += 'Terminal ready. Type "start" or essential commands like "echo", "date", or "website".\n';
            }, 3000);
        }

        // Open website in about:blank embed
        function openWebsite(url) {
            webView.src = url;
            webView.style.display = 'block';
        }

        // Run boot-up sequence
        window.onload = function() {
            bootupScreen();
        };
    </script>
</body>
</html>
