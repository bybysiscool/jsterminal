<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal Game</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
        body {
            margin: 0;
            background-color: black;
            color: white;
            font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
            height: 100vh;
            overflow: hidden;
        }

        #terminal {
            padding: 20px;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        #output {
            flex-grow: 1;
            white-space: pre-wrap;
            overflow-y: auto;
            word-wrap: break-word;
            max-height: calc(100% - 40px);
        }

        #input-line {
            display: flex;
            margin-top: 10px;
        }

        #input {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            outline: none;
            display: inline;
        }

        #cursor {
            display: inline-block;
            width: 10px;
            height: 18px;
            background-color: white;
            animation: blink 1s step-start infinite;
        }

        @keyframes blink {
            50% { background-color: transparent; }
        }

        .mac-buttons {
            display: flex;
            margin-bottom: 10px;
        }

        .mac-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .red { background-color: #FF605C; }
        .yellow { background-color: #FFBD44; }
        .green { background-color: #00CA4E; }

        .decision-effect {
            color: lime;
            font-weight: bold;
        }

        .game-over {
            color: red;
            font-weight: bold;
        }

        .glow {
            text-shadow: 0 0 5px white;
        }

        /* For the iframe */
        #web-view {
            display: none;
            position: absolute;
            width: 100%;
            height: 100%;
            border: none;
            background-color: white;
            z-index: 9999;
        }

        /* Additional styles for effects */
        .destroy-effect {
            animation: shake 0.5s forwards;
        }

        @keyframes shake {
            0% { transform: translate(0); }
            25% { transform: translate(-5px); }
            50% { transform: translate(5px); }
            75% { transform: translate(-5px); }
            100% { transform: translate(0); }
        }

        /* Explosion effect */
        @keyframes explosion {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(2); opacity: 0.5; }
            100% { transform: scale(5); opacity: 0; }
        }

        .explosion {
            width: 100px;
            height: 100px;
            background-color: red;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: explosion 2s forwards;
        }
    </style>
</head>
<body>
    <div id="terminal">
        <div class="mac-buttons">
            <div class="mac-button red"></div>
            <div class="mac-button yellow"></div>
            <div class="mac-button green"></div>
        </div>
        <div id="output"></div>
        <div id="input-line">
            <span>$ </span><span id="input"></span><span id="cursor"></span>
        </div>
    </div>

    <iframe id="web-view"></iframe>

    <script>
        const terminal = document.getElementById('terminal');
        const output = document.getElementById('output');
        const input = document.getElementById('input');
        const cursor = document.getElementById('cursor');
        const webView = document.getElementById('web-view');

        let gameState = {
            started: false,
            foundLore: false,
            decisions: 0,
            ended: false,
            hearts: 8,
        };

        let booting = true;
        let userInput = '';

        // Typing sound effect
        const typingSound = new Audio('typing-sound.mp3'); // Add a typing sound file here
        const explosionSound = new Audio('explosion.mp3'); // Add explosion sound for the boss fight transition
        const shootSound = new Audio('shoot.mp3'); // Add shooting sound file
        const damageSound = new Audio('damage.mp3'); // Add damage sound file

        // Input system
        document.addEventListener('keydown', function(event) {
            if (booting) return;

            if (event.key === 'Backspace') {
                userInput = userInput.slice(0, -1);
            } else if (event.key === 'Enter' && !gameState.ended) {
                processInput(userInput.trim());
                userInput = '';
            } else if (event.key.length === 1) {
                userInput += event.key;
            }

            input.textContent = userInput;
            terminal.scrollTop = terminal.scrollHeight; // Auto scroll to bottom
        });

        // Essential commands
        const essentialCommands = {
            echo: (args) => `echoing: ${args.join(' ')}`,
            date: () => new Date().toLocaleString(),
            website: (args) => {
                if (args.length > 0) {
                    const url = args[0].startsWith('http') ? args[0] : `https://${args[0]}`;
                    openWebsite(url);
                    return `Opening ${url} in a new window...`;
                }
                return 'Usage: website <url>';
            },
        };

        // Process input
        function processInput(command) {
            const [cmd, ...args] = command.split(' ');

            if (!gameState.started) {
                if (cmd === 'start') {
                    gameState.started = true;
                    typeWriter('The terminal hums with hidden power. A mystery lies within...\nCan you find all of the secrets?\n');
                } else if (cmd in essentialCommands) {
                    typeWriter(`${essentialCommands[cmd](args)}\n`);
                } else {
                    typeWriter('Invalid command. Type "start" to begin.\n');
                }
            } else if (gameState.started && !gameState.foundLore) {
                if (cmd === 'lore') {
                    gameState.foundLore = true;
                    typeWriter(longLore(), 50); // Slower for lore
                } else if (cmd in essentialCommands) {
                    typeWriter(`${essentialCommands[cmd](args)}\n`);
                } else {
                    typeWriter('Invalid command. Type "lore" to continue.\n');
                }
            } else if (gameState.foundLore && gameState.decisions < 15) {
                handleDecision(cmd);
            }

            // Handle general commands
            if (cmd in essentialCommands) {
                typeWriter(`${essentialCommands[cmd](args)}\n`);
            }
        }

        // Handle decisions
        function handleDecision(cmd) {
            const decisionPrompts = [
                'Do you face the shadows or hide from the truth?',
                'Will you challenge the essence or embrace it?',
                'Do you delve deeper into the code or step back?',
                'Will you break the seal of creation or leave it intact?',
                'Do you seek to destroy the terminal or find peace within it?',
                'Will you accept the creator’s will or defy it?',
                'Do you believe in the myths or in reality?',
                'Will you unlock the final secret or remain in ignorance?',
                'Is the truth worth the cost?',
                'Do you seek the creator or the destruction of the terminal?',
                'Will you fight the creator or submit?',
                'Do you dare to confront the abyss or retreat?',
                'Will you wield the power of creation or succumb to chaos?',
                'Do you seek knowledge or safety?',
                'Will you join the shadows or illuminate the truth?',
            ];

            const decisions = {
                face: () => nextDecision('You face the shadows and step into the unknown...', 100),
                hide: () => endGame('hid from the truth', 'You turned away, the darkness consumes you.'),
                challenge: () => nextDecision('You challenge the essence, power surges within you...', 100),
                embrace: () => nextDecision('You embrace the unknown, becoming one with the code...', 100),
                delve: () => nextDecision('You delve deeper, uncovering more hidden truths...', 100),
                step: () => endGame('stepped back', 'You stepped away from the journey.'),
                break: () => nextDecision('You break the seal, unleashing untold power...', 100),
                leave: () => endGame('left the seal intact',

 'The truth remains sealed, and you fade into obscurity.'),
                destroy: () => finalBoss(),
                peace: () => endGame('found peace', 'In peace, you found solace but never the truth.'),
                accept: () => nextDecision('You accept the creator’s will, and the code shifts...', 100),
                defy: () => endGame('defied the will', 'In defiance, you were lost to the void.'),
                believe: () => nextDecision('You believe in the myths, and they awaken within you...', 100),
                unlock: () => endGame('unlocked the final secret', 'The final secret destroyed you.'),
                seek: () => nextDecision('You seek the creator, and a path opens...', 100),
                fight: () => endGame('fought the creator', 'You fought bravely but fell to the creator.'),
                retreat: () => endGame('retreated', 'You retreated into obscurity, never to be seen again.'),
                wield: () => endGame('wielded the power of creation', 'The power consumed you.'),
                succumb: () => endGame('succumbed to chaos', 'You fell into chaos and were lost.'),
                knowledge: () => nextDecision('You seek knowledge, it flows into you...', 100),
                safety: () => endGame('sought safety', 'You remained safe but never learned.'),
                join: () => nextDecision('You join the shadows, becoming one with the night...', 100),
                illuminate: () => endGame('illuminated the truth', 'You shone brightly, but the shadows swallowed you.'),
            };

            const decision = cmd.toLowerCase();
            if (decisions[decision]) {
                decisions[decision]();
            } else {
                typeWriter('Invalid choice. Please make a decision.\n');
            }
        }

        // Next decision
        function nextDecision(message, delay) {
            gameState.decisions++;
            typeWriter(message + `\n${getDecisionPrompt()}`, delay);
        }

        // Final boss encounter
        function finalBoss() {
            gameState.ended = true;
            output.innerHTML += '<div class="explosion"></div>';
            typeWriter('The ground shakes as the creator emerges...\nPrepare for battle!\n', 100);
            explosionSound.play();
            // Start the boss fight logic here
            typeWriter('You engage in an epic battle against the creator!\n', 100);
            // Simulate fight - you can extend this logic further
            setTimeout(() => {
                if (Math.random() < 0.5) {
                    endGame('lost the battle', 'You were defeated by the creator. Game over.');
                } else {
                    typeWriter('You triumphed against the creator!\nYou have saved the terminal.\n', 100);
                }
            }, 2000);
        }

        // End game function
        function endGame(action, message) {
            gameState.ended = true;
            typeWriter(`You ${action}. ${message}\n`, 100);
        }

        // Typewriter effect
        function typeWriter(text, delay = 30) {
            const words = text.split(' ');
            let index = 0;
            const interval = setInterval(() => {
                if (index < words.length) {
                    output.innerHTML += words[index] + ' ';
                    index++;
                    terminal.scrollTop = terminal.scrollHeight; // Auto scroll to bottom
                } else {
                    clearInterval(interval);
                }
            }, delay);
        }

        // Long lore
        function longLore() {
            return `Long ago, in a realm beyond the understanding of mortals, the creator crafted a terminal unlike any other. 
            It held within it the secrets of the universe, the whispers of the past, and the echoes of future possibilities. 
            But with great power came great danger. As the creator’s will intertwined with the fabric of existence, 
            the terminal became a battleground for those who sought to harness its power or to destroy it entirely. 
            Only the brave would venture into its depths, confronting shadows of doubt, fears of the unknown, 
            and ultimately the very essence of creation itself. Your journey begins now. Are you ready to uncover the mysteries 
            or will you succumb to the abyss?`;
        }

        // Open website function
        function openWebsite(url) {
            webView.src = url;
            webView.style.display = 'block';
            webView.contentWindow.location.href = url; // Open in a blank embed
        }

        // Get decision prompt
        function getDecisionPrompt() {
            return `What will you do?\n` + 
                   `1. Face the shadows\n` + 
                   `2. Hide from the truth\n` + 
                   `3. Challenge the essence\n` + 
                   `4. Embrace the unknown\n` + 
                   `5. Delve deeper into the code\n` + 
                   `6. Step back\n` + 
                   `7. Break the seal of creation\n` + 
                   `8. Leave it intact\n` + 
                   `9. Destroy the terminal\n` + 
                   `10. Find peace within it\n` + 
                   `11. Accept the creator’s will\n` + 
                   `12. Defy it\n` + 
                   `13. Believe in the myths\n` + 
                   `14. Unlock the final secret\n` + 
                   `15. Seek the creator\n` + 
                   `16. Fight the creator\n` + 
                   `17. Retreat\n` + 
                   `18. Wield the power of creation\n` + 
                   `19. Succumb to chaos\n` + 
                   `20. Seek knowledge\n` + 
                   `21. Seek safety\n` + 
                   `22. Join the shadows\n` + 
                   `23. Illuminate the truth\n`;
        }

        // Boot up screen
        function bootUp() {
            typeWriter('Booting up...\n', 100);
            setTimeout(() => {
                booting = false;
                typeWriter('Boot complete. Type "start" to begin.\n', 100);
            }, 3000);
        }

        // Initiate boot process
        bootUp();
    </script>
</body>
</html>
