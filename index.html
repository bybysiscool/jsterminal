<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal Game</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
        body {
            margin: 0;
            background-color: black;
            color: white;
            font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
            height: 100vh;
            overflow: hidden;
        }

        #terminal {
            padding: 20px;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        #output {
            flex-grow: 1;
            white-space: pre-wrap;
            overflow-y: auto;
            word-wrap: break-word;
            max-height: calc(100% - 40px);
        }

        #input-line {
            display: flex;
            margin-top: 10px;
        }

        #input {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            outline: none;
            display: inline;
        }

        #cursor {
            display: inline-block;
            width: 10px;
            height: 18px;
            background-color: white;
            animation: blink 1s step-start infinite;
        }

        @keyframes blink {
            50% { background-color: transparent; }
        }

        .mac-buttons {
            display: flex;
            margin-bottom: 10px;
        }

        .mac-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .red { background-color: #FF605C; }
        .yellow { background-color: #FFBD44; }
        .green { background-color: #00CA4E; }

        .decision-effect {
            color: lime;
            font-weight: bold;
        }

        .game-over {
            color: red;
            font-weight: bold;
        }

        .glow {
            text-shadow: 0 0 5px white;
        }

        /* For the iframe */
        #web-view {
            display: none;
            position: absolute;
            width: 100%;
            height: 100%;
            border: none;
            background-color: white;
            z-index: 9999;
        }

        /* Additional styles for effects */
        .destroy-effect {
            animation: shake 0.5s forwards;
        }

        @keyframes shake {
            0% { transform: translate(0); }
            25% { transform: translate(-5px); }
            50% { transform: translate(5px); }
            75% { transform: translate(-5px); }
            100% { transform: translate(0); }
        }

        /* Explosion effect */
        @keyframes explosion {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(2); opacity: 0.5; }
            100% { transform: scale(5); opacity: 0; }
        }

        .explosion {
            width: 100px;
            height: 100px;
            background-color: red;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: explosion 2s forwards;
        }

        .hearts {
            margin-top: 10px;
            color: red;
        }
    </style>
</head>
<body>
    <div id="terminal">
        <div class="mac-buttons">
            <div class="mac-button red"></div>
            <div class="mac-button yellow"></div>
            <div class="mac-button green"></div>
        </div>
        <div id="output"></div>
        <div id="input-line">
            <span>$ </span><span id="input"></span><span id="cursor"></span>
        </div>
    </div>

    <iframe id="web-view"></iframe>

    <script>
        const terminal = document.getElementById('terminal');
        const output = document.getElementById('output');
        const input = document.getElementById('input');
        const cursor = document.getElementById('cursor');
        const webView = document.getElementById('web-view');

        let gameState = {
            started: false,
            foundLore: false,
            decisions: 0,
            ended: false,
            hearts: 8,
        };

        let booting = true;
        let userInput = '';
        let typing = false; // Prevents command input while typing

        // Sound effects
        const typingSound = new Audio('typing-sound.mp3'); // Add your typing sound file
        const explosionSound = new Audio('explosion.mp3'); // Explosion sound
        const shootSound = new Audio('shoot.mp3'); // Shooting sound
        const damageSound = new Audio('damage.mp3'); // Damage sound

        // Input system
        document.addEventListener('keydown', function(event) {
            if (booting || typing) return;

            if (event.key === 'Backspace') {
                userInput = userInput.slice(0, -1);
            } else if (event.key === 'Enter' && !gameState.ended) {
                processInput(userInput.trim());
                userInput = '';
            } else if (event.key.length === 1) {
                userInput += event.key;
            }

            input.textContent = userInput;
            terminal.scrollTop = terminal.scrollHeight; // Auto scroll to bottom
        });

        // Essential commands
        const essentialCommands = {
            echo: (args) => `echoing: ${args.join(' ')}`,
            date: () => new Date().toLocaleString(),
            website: (args) => {
                if (args.length > 0) {
                    const url = args[0].startsWith('http') ? args[0] : `https://${args[0]}`;
                    openWebsite(url);
                    return `Opening ${url} in a new window...`;
                }
                return 'Usage: website <url>';
            },
        };

        // Process input
        function processInput(command) {
            const [cmd, ...args] = command.split(' ');

            if (!gameState.started) {
                if (cmd === 'start') {
                    gameState.started = true;
                    typeWriter('The terminal hums with hidden power. A mystery lies within...\nCan you find all of the secrets?\n');
                } else if (cmd in essentialCommands) {
                    typeWriter(`${essentialCommands[cmd](args)}\n`);
                } else {
                    typeWriter('Invalid command. Type "start" to begin.\n');
                }
            } else if (gameState.started && !gameState.foundLore) {
                if (cmd === 'lore') {
                    gameState.foundLore = true;
                    typeWriter(longLore(), 100); // Faster for lore
                } else if (cmd in essentialCommands) {
                    typeWriter(`${essentialCommands[cmd](args)}\n`);
                } else {
                    typeWriter('Invalid command. Type "lore" to continue.\n');
                }
            } else if (gameState.foundLore && gameState.decisions < 15) {
                handleDecision(cmd);
            }

            // Handle general commands
            if (cmd in essentialCommands) {
                typeWriter(`${essentialCommands[cmd](args)}\n`);
            }
        }

        // Handle decisions
        function handleDecision(cmd) {
            const decisionPrompts = [
                'Do you face the shadows or hide from the truth?',
                'Will you challenge the essence or embrace it?',
                'Do you delve deeper into the code or step back?',
                'Will you break the seal of creation or leave it intact?',
                'Do you seek to destroy the terminal or find peace within it?',
                'Will you accept the creator’s will or defy it?',
                'Do you believe in the myths or in reality?',
                'Will you unlock the final secret or remain in ignorance?',
                'Is the truth worth the cost?',
                'Do you seek the creator or the destruction of the terminal?',
                'Will you fight the creator or submit?',
                'Do you step forward into the unknown?',
                'Will you trust in the whispers of the code?',
                'Do you confront your fears or flee from them?',
                'Will you gather allies or face the creator alone?',
                'Do you pursue knowledge or power?',
                'Will you change the fate of the terminal or accept it?',
            ];

            const decisions = {
                face: () => nextDecision('You face the shadows and step into the unknown...', 100),
                hide: () => endGame('hid from the truth', 'You turned away, the darkness consumes you.'),
                challenge: () => nextDecision('You challenge the essence, power surges within you...', 100),
                embrace: () => nextDecision('You embrace the unknown, becoming one with the code...', 100),
                delve: () => nextDecision('You delve deeper, uncovering more hidden truths...', 100),
                step: () => endGame('stepped back', 'You stepped away

, the truth eludes you.'),
                break: () => nextDecision('You break the seal, the terminal quakes with power...', 100),
                leave: () => endGame('left it intact', 'The seal remains, and so does the mystery.'),
                destroy: () => nextDecision('You seek to destroy the terminal, power at your fingertips...', 100),
                peace: () => endGame('found peace', 'You found peace within, yet the world remains untouched.'),
                accept: () => nextDecision('You accept the creator’s will, fate intertwines with your own...', 100),
                defy: () => endGame('defied it', 'You defy the creator, chaos ensues.'),
                believe: () => nextDecision('You believe in the myths, unraveling ancient powers...', 100),
                reality: () => endGame('believed in reality', 'Reality blinds you, and the truth escapes.'),
                unlock: () => nextDecision('You unlock the final secret, the terminal responds...', 100),
                remain: () => endGame('remained in ignorance', 'Ignorance is bliss, but knowledge calls.'),
                cost: () => endGame('truth worth the cost', 'The cost was high, and you paid dearly.'),
                pursue: () => nextDecision('You pursue knowledge, the creator’s form materializes...', 100),
                fight: () => nextDecision('You choose to fight the creator, a battle unfolds...', 100),
                trust: () => nextDecision('You trust the whispers of the code, guidance leads you...', 100),
                confront: () => nextDecision('You confront your fears, strength fills you...', 100),
                allies: () => nextDecision('You gather allies, together you face the darkness...', 100),
                alone: () => endGame('faced alone', 'Facing the darkness alone is a perilous journey.'),
                change: () => nextDecision('You strive to change the fate of the terminal, an epic battle is brewing...', 100),
            };

            // Check the command against decisions
            if (decisionPrompts.some(prompt => cmd.toLowerCase().includes(prompt.split(' ')[0]))) {
                const decisionCommand = Object.keys(decisions).find(d => cmd.includes(d));
                if (decisionCommand) {
                    decisions[decisionCommand]();
                    gameState.decisions++;
                } else {
                    typeWriter('Invalid choice. Please choose again.\n');
                }
            } else {
                typeWriter('Choose wisely...\n');
            }
        }

        // Next decision in the story
        function nextDecision(text, delay) {
            typing = true;
            typeWriter(text, delay);
        }

        // End the game
        function endGame(decision, message) {
            typing = false;
            gameState.ended = true;
            typeWriter(`${message}\nGame Over.\n`);
            terminal.removeEventListener('keydown', processInput);
        }

        // Lore content
        function longLore() {
            return `Lore: In a world governed by a mysterious creator, hidden truths await discovery. As you dive into the depths of this terminal, 
            your choices will shape the fate of not just your character, but the very fabric of reality itself. Can you unravel the secrets before you, 
            or will you succumb to the power that lies within? This is a journey through fear, knowledge, and the ultimate confrontation with the creator.`;
        }

        // Typewriter effect
        function typeWriter(text, speed = 50) {
            typingSound.play();
            let i = 0;
            typing = true;
            const interval = setInterval(() => {
                if (i < text.length) {
                    output.textContent += text.charAt(i);
                    i++;
                    terminal.scrollTop = terminal.scrollHeight; // Auto scroll to bottom
                } else {
                    clearInterval(interval);
                    typing = false;
                    typingSound.pause();
                    typingSound.currentTime = 0; // Reset sound
                    if (gameState.decisions >= 15) {
                        setTimeout(bossFight, 500);
                    }
                }
            }, speed);
        }

        // Boss fight
        function bossFight() {
            output.innerHTML += '<div class="explosion"></div>';
            explosionSound.play();
            typeWriter('The creator stands before you, power radiating in waves. You have chosen your fate. Prepare for battle...\n', 100);
            displayHearts();
        }

        // Display hearts during the boss fight
        function displayHearts() {
            const heartsDiv = document.createElement('div');
            heartsDiv.classList.add('hearts');
            heartsDiv.textContent = '❤❤❤❤❤❤❤❤';
            output.appendChild(heartsDiv);
        }

        // Open website function
        function openWebsite(url) {
            webView.style.display = 'block';
            webView.src = url;
        }

        // Booting sequence
        function bootSequence() {
            const bootMessages = [
                'Booting up...',
                'Initializing system files...',
                'Loading interface...',
                'Connecting to server...',
                'Running diagnostics...',
                'All systems operational.'
            ];

            let i = 0;
            const bootInterval = setInterval(() => {
                if (i < bootMessages.length) {
                    typeWriter(bootMessages[i] + '\n', 50);
                    i++;
                } else {
                    clearInterval(bootInterval);
                    booting = false;
                    typeWriter('Type "start" to begin your journey...\n');
                }
            }, 2000);
        }

        bootSequence();
    </script>
</body>
</html>
