<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal Game</title>
    <style>
        body {
            margin: 0;
            background-color: black;
            color: white;
            font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
        }

        #terminal {
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-y: scroll;
        }

        #output {
            flex-grow: 1;
            white-space: pre-wrap;
        }

        #input-line {
            display: flex;
            margin-top: 10px;
        }

        #input {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            outline: none;
            caret-color: transparent;
        }

        #cursor {
            display: inline-block;
            width: 10px;
            height: 18px;
            background-color: white;
            animation: blink 1s step-start infinite;
        }

        @keyframes blink {
            50% { background-color: transparent; }
        }

        .mac-buttons {
            display: flex;
            margin-bottom: 10px;
        }

        .mac-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .red { background-color: #FF605C; }
        .yellow { background-color: #FFBD44; }
        .green { background-color: #00CA4E; }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .decision-effect {
            color: lime;
            font-weight: bold;
        }

        .game-over {
            color: red;
            font-weight: bold;
        }

        .glow {
            text-shadow: 0 0 5px white;
        }

        .bootup-screen {
            font-size: 14px;
            animation: fadeIn 1s ease-out;
        }
    </style>
</head>
<body>
    <div id="terminal">
        <div class="mac-buttons">
            <div class="mac-button red"></div>
            <div class="mac-button yellow"></div>
            <div class="mac-button green"></div>
        </div>
        <div id="output"></div>
        <div id="input-line">
            <span>$ </span><span id="input"></span><span id="cursor"></span>
        </div>
    </div>

    <script>
        const terminal = document.getElementById('terminal');
        const output = document.getElementById('output');
        const input = document.getElementById('input');
        const cursor = document.getElementById('cursor');

        let gameState = {
            started: false,
            foundLore: false,
            decision1: false,
            decision2: false,
            ended: false,
        };

        let booting = true;
        let userInput = '';

        // Initialize input system
        document.addEventListener('keydown', function(event) {
            if (booting) return;

            if (event.key === 'Backspace') {
                userInput = userInput.slice(0, -1);
            } else if (event.key === 'Enter' && !gameState.ended) {
                processInput(userInput.trim());
                userInput = '';
            } else if (event.key.length === 1) {
                userInput += event.key;
            }

            input.textContent = userInput;
            terminal.scrollTop = terminal.scrollHeight;
        });

        // Essential commands
        const essentialCommands = {
            echo: (args) => `echoing: ${args.join(' ')}`,
            date: () => new Date().toLocaleString(),
            website: (args) => {
                if (args.length > 0) {
                    const url = args[0].startsWith('http') ? args[0] : `https://${args[0]}`;
                    openWebsite(url);
                    return `Opening ${url}...`;
                }
                return 'Usage: website <url>';
            },
        };

        // Handle input processing
        function processInput(command) {
            if (!gameState.started) {
                if (command === 'start') {
                    gameState.started = true;
                    output.innerHTML += '$ ' + command + '\n';
                    output.innerHTML += 'You have entered a world of ancient secrets...\n';
                    output.innerHTML += 'Can you find all of the secrets?\n';
                } else if (command in essentialCommands) {
                    output.innerHTML += `$ ${command}\n${essentialCommands[command]([])}\n`;
                } else {
                    output.innerHTML += `$ ${command}\nInvalid command. Type "start" to begin.\n`;
                }
            } else if (gameState.started && !gameState.foundLore) {
                if (command === 'lore') {
                    gameState.foundLore = true;
                    output.innerHTML += '$ ' + command + '\n';
                    output.innerHTML += 'A hidden past reveals itself...\n';
                    output.innerHTML += 'Do you wish to SEEK the truth or DENY it?\n';
                    applyEffect('decision-effect', 'The choice is yours...');
                } else if (command in essentialCommands) {
                    output.innerHTML += `$ ${command}\n${essentialCommands[command]([])}\n`;
                } else {
                    output.innerHTML += '$ ' + command + '\nInvalid command. Type "lore" to continue.\n';
                }
            } else if (gameState.foundLore && !gameState.decision1) {
                if (command === 'seek') {
                    gameState.decision1 = true;
                    output.innerHTML += '$ ' + command + '\n';
                    output.innerHTML += 'The truth unveils itself, but shadows gather...\n';
                    applyEffect('decision-effect', 'What will you do next? FACE it or HIDE?\n');
                } else if (command === 'deny') {
                    gameState.decision1 = true;
                    endGame('denied the truth', 'The story ends here.');
                } else if (command in essentialCommands) {
                    output.innerHTML += `$ ${command}\n${essentialCommands[command]([])}\n`;
                } else {
                    output.innerHTML += '$ ' + command + '\nInvalid command. Type "seek" or "deny".\n';
                }
            } else if (gameState.decision1 && !gameState.decision2) {
                if (command === 'face') {
                    gameState.decision2 = true;
                    endGame('faced the shadow', 'You uncovered the hidden knowledge. Victory is yours!');
                } else if (command === 'hide') {
                    gameState.decision2 = true;
                    endGame('hid from the shadow', 'You were consumed by the darkness.');
                } else if (command in essentialCommands) {
                    output.innerHTML += `$ ${command}\n${essentialCommands[command]([])}\n`;
                } else {
                    output.innerHTML += '$ ' + command + '\nInvalid command. Type "face" or "hide".\n';
                }
            }
        }

        // Add visual effects for decisions
        function applyEffect(effectClass, message) {
            const effectElement = document.createElement('div');
            effectElement.className = effectClass + ' glow';
            effectElement.textContent = message;
            output.appendChild(effectElement);
            terminal.scrollTop = terminal.scrollHeight;
        }

        // End the game with effects
        function endGame(outcome, message) {
            gameState.ended = true;
            output.innerHTML += `$ Game Over: You ${outcome}.\n${message}\n`;
            applyEffect('game-over', message);
        }

        // Boot-up screen
        function bootupScreen() {
            output.innerHTML += 'Starting terminal...\n';
            output.innerHTML += 'Loading system files...\n';
            output.innerHTML += 'Initializing...\n';
            setTimeout(() => {
                booting = false;
                output.innerHTML += 'Terminal ready. Type "start" or essential commands like "echo", "date", or "website".\n';
            }, 3000);
        }

        // Open website in a new tab via embed
        function openWebsite(url) {
            const newWindow = window.open('about:blank', '_blank');
            newWindow.location.href = url;
        }

        // Run boot-up sequence on load
        window.onload = function() {
            bootupScreen();
        };
    </script>
</body>
</html>
